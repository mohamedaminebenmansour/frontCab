<div *ngIf="alertMessage" class="p-4 mb-4 text-white rounded" [ngClass]="{
  'bg-green-500': alertType === 'success',
  'bg-red-500': alertType === 'error'
}">
    {{ alertMessage }}
    <button (click)="alertMessage = null; alertType = null" class="float-right text-white underline">Dismiss</button>
</div>

<div class="flex justify-between items-center mb-4">
    <h1 class="text-xl font-bold">Storage Bin Details</h1>
    <button (click)="toggleForm()" class="px-4 py-2 text-white bg-blue-500 rounded hover:bg-blue-600 transition">
        {{ isFormVisible ? 'Cancel' : 'Add New Detail' }}
    </button>
</div>

<form *ngIf="isFormVisible" (ngSubmit)="saveDetail()" class="mt-4 space-y-6 bg-gray-50 p-6 rounded-lg shadow">
    <div>
        <label for="ewmCodeLocation" class="block text-sm font-medium text-gray-700">EWM Code Location</label>
        <select id="ewmCodeLocation" [(ngModel)]="selectedDetail.ewm_CodeLocation" name="ewm_CodeLocation"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            <option value="">Select Storage Bin</option>
            <option *ngFor="let bin of storageBins" [value]="bin.ewm_Lib_CodeLocation">
                {{ bin.ewm_Lib_CodeLocation }} (Type: {{ bin.ewm_Code_StorageType }})
            </option>
        </select>
    </div>

    <div>
        <label for="sequenceInLocation" class="block text-sm font-medium text-gray-700">Sequence In Location</label>
        <input id="sequenceInLocation" type="number" [(ngModel)]="selectedDetail.sequenceInLocation"
            name="sequenceInLocation"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter sequence (e.g., 1)" required>
    </div>

    <div>
        <label for="stockageDate" class="block text-sm font-medium text-gray-700">Stockage Date</label>
        <input id="stockageDate" type="date" [(ngModel)]="selectedDetail.stockageDate" name="stockageDate"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter stockage date">
    </div>

    <div>
        <label for="status" class="block text-sm font-medium text-gray-700">Status</label>
        <select id="status" [(ngModel)]="selectedDetail.status" name="status"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">Select Status</option>
            <option value="0">Empty</option>
            <option value="1">Full</option>
            <option value="2">Partial</option>
            <option value="3">Reserved</option>
            <option value="4">Blocked</option>
        </select>
    </div>

    <div>
        <label for="item" class="block text-sm font-medium text-gray-700">Item</label>
        <input id="item" [(ngModel)]="selectedDetail.item" name="item"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter item">
    </div>

    <div>
        <label for="serialNumber" class="block text-sm font-medium text-gray-700">Serial Number</label>
        <input id="serialNumber" [(ngModel)]="selectedDetail.serialNumber" name="serialNumber"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter serial number">
    </div>

    <div>
        <label for="handlingUnit" class="block text-sm font-medium text-gray-700">Handling Unit</label>
        <input id="handlingUnit" [(ngModel)]="selectedDetail.handlingUnit" name="handlingUnit"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter handling unit">
    </div>

    <div>
        <label for="productionDate" class="block text-sm font-medium text-gray-700">Production Date</label>
        <input id="productionDate" type="date" [(ngModel)]="selectedDetail.productionDate" name="productionDate"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter production date">
    </div>

    <div>
        <label for="initialQty" class="block text-sm font-medium text-gray-700">Initial Qty</label>
        <input id="initialQty" type="number" [(ngModel)]="selectedDetail.initialQty" name="initialQty"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter initial qty" required>
    </div>

    <div>
        <label for="actualQty" class="block text-sm font-medium text-gray-700">Actual Qty</label>
        <input id="actualQty" type="number" [(ngModel)]="selectedDetail.actualQty" name="actualQty"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter actual qty" required>
    </div>

    <div>
        <label for="initialWeight" class="block text-sm font-medium text-gray-700">Initial Weight</label>
        <input id="initialWeight" type="number" [(ngModel)]="selectedDetail.initialWeight" name="initialWeight"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter initial weight" required>
    </div>

    <div>
        <label for="actualWeight" class="block text-sm font-medium text-gray-700">Actual Weight</label>
        <input id="actualWeight" type="number" [(ngModel)]="selectedDetail.actualWeight" name="actualWeight"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter actual weight" required>
    </div>

    <div class="flex space-x-4">
        <button type="submit" class="px-4 py-2 text-white bg-green-500 rounded hover:bg-green-600 transition"
            [disabled]="!selectedDetail.ewm_CodeLocation || !selectedDetail.sequenceInLocation || !selectedDetail.initialQty || !selectedDetail.actualQty || !selectedDetail.initialWeight || !selectedDetail.actualWeight">
            {{ isEditing ? 'Update Detail' : 'Create Detail' }}
        </button>
        <button type="button" (click)="toggleForm()"
            class="px-4 py-2 text-gray-700 bg-gray-200 rounded hover:bg-gray-300 transition">
            Cancel
        </button>
    </div>
</form>

<div class="mt-6">
    <h2 class="text-lg font-bold">Existing Storage Bin Details</h2>
    <div *ngIf="isLoading" class="text-center py-4">
        <p class="text-gray-500">Loading details...</p>
    </div>
    <div *ngIf="!isLoading && details.length === 0" class="text-center py-4">
        <p class="text-gray-500">No details found.</p>
    </div>
    <div *ngFor="let detail of details" class="p-4 mt-2 border rounded bg-white shadow">
        <p><strong>EWM Code Location:</strong> {{ detail.ewm_CodeLocation }}</p>
        <p><strong>Sequence In Location:</strong> {{ detail.sequenceInLocation }}</p>
        <p><strong>Stockage Date:</strong> {{ detail.stockageDate }}</p>
        <p><strong>Status:</strong> {{ detail.status }}</p>
        <p><strong>Item:</strong> {{ detail.item }}</p>
        <p><strong>Serial Number:</strong> {{ detail.serialNumber }}</p>
        <p><strong>Handling Unit:</strong> {{ detail.handlingUnit }}</p>
        <p><strong>Production Date:</strong> {{ detail.productionDate }}</p>
        <p><strong>Initial Qty:</strong> {{ detail.initialQty }}</p>
        <p><strong>Actual Qty:</strong> {{ detail.actualQty }}</p>
        <p><strong>Initial Weight:</strong> {{ detail.initialWeight }}</p>
        <p><strong>Actual Weight:</strong> {{ detail.actualWeight }}</p>
        <div class="mt-3 space-x-2">
            <button (click)="editDetail(detail)"
                class="px-3 py-1 text-white bg-yellow-500 rounded hover:bg-yellow-600 transition">
                Edit
            </button>
            <button (click)="deleteDetail(detail.idLocation_Details!)"
                class="px-3 py-1 text-white bg-red-500 rounded hover:bg-red-600 transition">
                Delete
            </button>
        </div>
    </div>
</div>