<div *ngIf="alertMessage" class="p-4 mb-4 text-white rounded" [ngClass]="{
  'bg-green-500': alertType === 'success',
  'bg-red-500': alertType === 'error'
}">
    {{ alertMessage }}
    <button (click)="alertMessage = null; alertType = null" class="float-right text-white underline">Dismiss</button>
</div>

<div class="flex justify-between items-center mb-4">
    <h1 class="text-xl font-bold">Storage Bins</h1>
    <button (click)="toggleForm()" class="px-4 py-2 text-white bg-blue-500 rounded hover:bg-blue-600 transition">
        {{ isFormVisible ? 'Cancel' : 'Add New Storage Bin' }}
    </button>
</div>

<form *ngIf="isFormVisible" (ngSubmit)="saveBin()" class="mt-4 space-y-6 bg-gray-50 p-6 rounded-lg shadow">
    <div>
        <label for="libCodeLocation" class="block text-sm font-medium text-gray-700">Lib Code Location</label>
        <input id="libCodeLocation" [(ngModel)]="selectedBin.ewm_Lib_CodeLocation" name="ewm_Lib_CodeLocation"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter lib code location (e.g., BIN001)" required>
    </div>

    <div>
        <label for="codeLocationGroupe" class="block text-sm font-medium text-gray-700">Code Location Groupe</label>
        <select id="codeLocationGroupe" [(ngModel)]="selectedBin.codeLocationGroupe" name="codeLocationGroupe"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            <option value="">Select Location Groupe</option>
            <option *ngFor="let group of binGroups" [value]="group.codeLocationGroupe">
                {{ group.codeLocationGroupe }} - {{ group.lib_LocationGroupe }}
            </option>
        </select>
    </div>

    <div>
        <label for="ewmCodeStorageType" class="block text-sm font-medium text-gray-700">EWM Code Storage Type</label>
        <select id="ewmCodeStorageType" [(ngModel)]="selectedBin.ewm_Code_StorageType" name="ewm_Code_StorageType"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            <option value="">Select Storage Type</option>
            <option *ngFor="let type of storageTypes" [value]="type.code">
                {{ type.code }} - {{ type.lib }}
            </option>
        </select>
    </div>

    <div>
        <label for="codeStorageBinType" class="block text-sm font-medium text-gray-700">Code Storage Bin Type</label>
        <select id="codeStorageBinType" [(ngModel)]="selectedBin.codeStorageBinType" name="codeStorageBinType"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            <option value="">Select Bin Type</option>
            <option *ngFor="let binType of binTypes" [value]="binType.codeStorageBinType">
                {{ binType.codeStorageBinType }} - {{ binType.lib_LocationType }}
            </option>
        </select>
    </div>

    <div>
        <label for="codeEwmDisplayParckGroupe" class="block text-sm font-medium text-gray-700">Code EWM Display Parck
            Groupe</label>
        <select id="codeEwmDisplayParckGroupe" [(ngModel)]="selectedBin.codeEwm_DisplayParckGroupe"
            name="codeEwm_DisplayParckGroupe"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            <option value="">Select Parck Display Groupe</option>
            <option *ngFor="let group of parckGroups" [value]="group.code">
                {{ group.code }} - {{ group.libelle }}
            </option>
        </select>
    </div>

    <div>
        <label for="codeFIFOGroupe" class="block text-sm font-medium text-gray-700">Code FIFO Groupe</label>
        <input id="codeFIFOGroupe" [(ngModel)]="selectedBin.code_FIFO_Groupe" name="code_FIFO_Groupe"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter FIFO groupe code (e.g., FIFO1)">
    </div>

    <div>
        <label for="atorizedStatus" class="block text-sm font-medium text-gray-700">Atorized Status</label>
        <select id="atorizedStatus" [(ngModel)]="selectedBin.atorizedStatus" name="atorizedStatus"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            <option value="">Select Atorized Status</option>
            <option *ngFor="let status of atorizedStatuses" [value]="status.codeAtorisedStatus">
                {{ status.codeAtorisedStatus }} - {{ status.valueAtorisedStatus }}
            </option>
        </select>
    </div>

    <div>
        <label for="item" class="block text-sm font-medium text-gray-700">Item</label>
        <input id="item" [(ngModel)]="selectedBin.item" name="item"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter item (e.g., Cable)">
    </div>

    <div>
        <label for="bulding" class="block text-sm font-medium text-gray-700">Bulding</label>
        <input id="bulding" [(ngModel)]="selectedBin.bulding" name="bulding"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter bulding (e.g., B01)">
    </div>

    <div>
        <label for="capacity" class="block text-sm font-medium text-gray-700">Capacity</label>
        <input id="capacity" type="number" [(ngModel)]="selectedBin.capacity" name="capacity"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter capacity (e.g., 1000)" required>
    </div>

    <div class="flex items-center">
        <input type="checkbox" id="qualityValidationMadatoryToAssign"
            [(ngModel)]="selectedBin.qualityValidationMadatoryToAssign" name="qualityValidationMadatoryToAssign"
            class="mr-2 h-4 w-4 text-blue-500 focus:ring-blue-500">
        <label for="qualityValidationMadatoryToAssign" class="text-gray-700">Quality Validation Mandatory To
            Assign</label>
    </div>

    <div class="flex items-center">
        <input type="checkbox" id="staticLocation" [(ngModel)]="selectedBin.staticLocation" name="staticLocation"
            class="mr-2 h-4 w-4 text-blue-500 focus:ring-blue-500">
        <label for="staticLocation" class="text-gray-700">Static Location</label>
    </div>

    <div class="flex items-center">
        <input type="checkbox" id="dynamicLocation" [(ngModel)]="selectedBin.dynamicLocation" name="dynamicLocation"
            class="mr-2 h-4 w-4 text-blue-500 focus:ring-blue-500">
        <label for="dynamicLocation" class="text-gray-700">Dynamic Location</label>
    </div>

    <div class="flex items-center">
        <input type="checkbox" id="exacticLocation" [(ngModel)]="selectedBin.exacticLocation" name="exacticLocation"
            class="mr-2 h-4 w-4 text-blue-500 focus:ring-blue-500">
        <label for="exacticLocation" class="text-gray-700">Exactic Location</label>
    </div>

    <div class="flex space-x-4">
        <button type="submit" class="px-4 py-2 text-white bg-green-500 rounded hover:bg-green-600 transition"
            [disabled]="!selectedBin.ewm_Lib_CodeLocation || !selectedBin.ewm_Code_StorageType || !selectedBin.codeStorageBinType || !selectedBin.codeEwm_DisplayParckGroupe || !selectedBin.atorizedStatus || !selectedBin.capacity">
            {{ isEditing ? 'Update Bin' : 'Create Bin' }}
        </button>
        <button type="button" (click)="toggleForm()"
            class="px-4 py-2 text-gray-700 bg-gray-200 rounded hover:bg-gray-300 transition">
            Cancel
        </button>
    </div>
</form>

<div class="mt-6">
    <h2 class="text-lg font-bold">Existing Storage Bins</h2>
    <div *ngIf="isLoading" class="text-center py-4">
        <p class="text-gray-500">Loading bins...</p>
    </div>
    <div *ngIf="!isLoading && bins.length === 0" class="text-center py-4">
        <p class="text-gray-500">No bins found.</p>
    </div>
    <div *ngFor="let bin of bins" class="p-4 mt-2 border rounded bg-white shadow">
        <p><strong>Lib Code Location:</strong> {{ bin.ewm_Lib_CodeLocation }}</p>
        <p><strong>Code Location Groupe:</strong> {{ bin.codeLocationGroupe }}</p>
        <p><strong>EWM Code Storage Type:</strong> {{ bin.ewm_Code_StorageType }}</p>
        <p><strong>Code Storage Bin Type:</strong> {{ bin.codeStorageBinType }}</p>
        <p><strong>Code EWM Display Parck Groupe:</strong> {{ bin.codeEwm_DisplayParckGroupe }}</p>
        <p><strong>Code FIFO Groupe:</strong> {{ bin.code_FIFO_Groupe }}</p>
        <p><strong>Atorized Status:</strong> {{ bin.atorizedStatus }}</p>
        <p><strong>Item:</strong> {{ bin.item }}</p>
        <p><strong>Bulding:</strong> {{ bin.bulding }}</p>
        <p><strong>Capacity:</strong> {{ bin.capacity }}</p>
        <p><strong>Quality Validation Mandatory:</strong> {{ bin.qualityValidationMadatoryToAssign ? 'Yes' : 'No' }}</p>
        <p><strong>Static Location:</strong> {{ bin.staticLocation ? 'Yes' : 'No' }}</p>
        <p><strong>Dynamic Location:</strong> {{ bin.dynamicLocation ? 'Yes' : 'No' }}</p>
        <p><strong>Exactic Location:</strong> {{ bin.exacticLocation ? 'Yes' : 'No' }}</p>
        <div class="mt-3 space-x-2">
            <button (click)="editBin(bin)"
                class="px-3 py-1 text-white bg-yellow-500 rounded hover:bg-yellow-600 transition">
                Edit
            </button>
            <button (click)="deleteBin(bin.idewm_Location!)"
                class="px-3 py-1 text-white bg-red-500 rounded hover:bg-red-600 transition">
                Delete
            </button>
        </div>
    </div>
</div>